{
  "description": "Enhanced AI webhook response format for field-specific permit improvements",
  "endpoint": "https://your-domain.com/api/webhooks/suggestions",
  "method": "POST",
  "headers": {
    "Content-Type": "application/json"
  },
  "required_response_format": {
    "permitId": "string (required) - Must match the permitId from the original request",
    "analysisComplete": "boolean (required) - Set to true when analysis is finished",
    "suggestions": "array (optional) - Array of field-specific suggestion objects",
    "riskAssessment": "object (optional) - Risk assessment data for logging",
    "recommendations": "object (optional) - Structured recommendations for logging",
    "compliance_notes": "string (optional) - Compliance information for logging",
    "error": "string (optional) - Error message if analysis failed"
  },
  "target_permit_fields": {
    "identifiedHazards": "Text field for complete hazard identification",
    "completedMeasures": "Array field for protective measures",
    "selectedHazards": "Array field for TRBS hazard category IDs",
    "hazardNotes": "JSON string field for structured hazard documentation",
    "additionalComments": "Text field for specific safety instructions"
  },
  "example_successful_response": {
    "permitId": "HT-2025-001",
    "analysisComplete": true,
    "suggestions": [
      {
        "type": "hazard_identification",
        "fieldName": "identifiedHazards",
        "originalValue": "Absturzgefahr, rutschige Oberflächen",
        "suggestedValue": "Absturzgefahr aus 15m Höhe, Rutschgefahr auf feuchten Dachflächen, Witterungseinflüsse (Wind, Regen), unzureichende Beleuchtung, herabfallende Gegenstände",
        "reasoning": "Vollständige Gefahrenidentifikation für Höhenarbeiten basierend auf TRBS 2121 und DGUV Regel 112-198",
        "priority": "high"
      },
      {
        "type": "protective_measures",
        "fieldName": "completedMeasures",
        "originalValue": ["fall_protection", "weather_check"],
        "suggestedValue": ["fall_protection", "weather_check", "safety_harness", "backup_anchor", "rescue_equipment", "work_area_secured", "emergency_plan"],
        "reasoning": "Standardschutzmaßnahmen für Höhenarbeiten nach TRBS 2121 - vollständige PSA und Rettungsausrüstung erforderlich",
        "priority": "high"
      },
      {
        "type": "trbs_hazard_mapping", 
        "fieldName": "selectedHazards",
        "originalValue": ["7-0"],
        "suggestedValue": ["7-0", "7-1", "1-0", "1-1"],
        "reasoning": "Zuordnung zu TRBS-Gefährdungskategorien: Mechanische Gefährdungen (7-0, 7-1) und physische Belastungen (1-0, 1-1)",
        "priority": "high"
      },
      {
        "type": "safety_notes_enhancement",
        "fieldName": "additionalComments",
        "originalValue": "Auffanggurt erforderlich",
        "suggestedValue": "Vollständige PSA für Höhenarbeiten (Auffanggurt, Helm, Sicherheitsschuhe). Arbeiten nur bei windstillen, trockenen Bedingungen. Rettungsmannschaft in Bereitschaft. Arbeitszeit realistisch auf mindestens 2 Stunden planen.",
        "reasoning": "Umfassende Sicherheitsanweisungen für Höhenarbeiten zur Minimierung des Absturzrisikos",
        "priority": "medium"
      },
      {
        "type": "hazard_notes_structure",
        "fieldName": "hazardNotes", 
        "originalValue": "{}",
        "suggestedValue": "{\"7-0\": \"Absturzgefahr - Sicherungsausrüstung zwingend erforderlich\", \"7-1\": \"Herabfallende Gegenstände - Arbeitsbereich absperren\", \"1-0\": \"Schwere körperliche Arbeit - Pausen einhalten\", \"1-1\": \"Einseitige Körperhaltung - ergonomische Hilfsmittel\"}",
        "reasoning": "Strukturierte Dokumentation der Gefährdungsbeurteilung mit spezifischen Schutzmaßnahmen je TRBS-Kategorie",
        "priority": "medium"
      }
    ],
    "riskAssessment": {
      "overallRisk": "high",
      "riskFactors": [
        "Absturzgefahr aus 15m Höhe - lebensgefährlich",
        "Rutschgefahr auf Dachflächen bei Feuchtigkeit", 
        "Witterungseinflüsse bei Außenarbeiten",
        "Unzureichende Gefahrenidentifikation",
        "Fehlende spezifische Schutzmaßnahmen definiert"
      ],
      "complianceScore": 65,
      "recommendations": [
        "Vollständige Gefährdungsbeurteilung nach TRBS 2121 durchführen",
        "Spezifische Schutzmaßnahmen für jede Gefährdungskategorie definieren",
        "Realistische Arbeitszeit für sichere Durchführung einplanen"
      ]
    },
    "recommendations": {
      "immediate_actions": [
        "Vollständige Gefahrenidentifikation durchführen",
        "Spezifische Schutzmaßnahmen für Höhenarbeiten definieren", 
        "TRBS-Gefährdungskategorien korrekt zuordnen"
      ],
      "before_work_starts": [
        "Vollständige PSA für Höhenarbeiten bereitstellen",
        "Wettervorhersage prüfen und sichere Bedingungen abwarten",
        "Rettungsausrüstung und Notfallplan aktivieren"
      ],
      "monitoring_requirements": [
        "Kontinuierliche Wetterüberwachung während der Arbeiten",
        "Regelmäßige Überprüfung der Sicherungsausrüstung",
        "Strukturierte Dokumentation aller Gefährdungen"
      ]
    },
    "compliance_notes": "Permit erfordert umfassende Verbesserungen nach TRBS 2121. Alle identifizierten Gefährdungen müssen durch entsprechende Schutzmaßnahmen abgedeckt und in den korrekten Datenbankfeldern dokumentiert werden."
  },
  "example_error_response": {
    "permitId": "HT-2025-001",
    "analysisComplete": false,
    "error": "AI analysis service temporarily unavailable",
    "suggestions": []
  },
  "notes": {
    "enhanced_suggestion_types": {
      "hazard_identification": "For improving identifiedHazards field - complete hazard analysis",
      "protective_measures": "For improving completedMeasures field - required safety measures",
      "trbs_hazard_mapping": "For improving selectedHazards field - TRBS category assignments",
      "hazard_notes_structure": "For improving hazardNotes field - structured safety documentation",
      "safety_instructions": "For improving additionalComments field - specific safety instructions"
    },
    "suggestion_object_fields": {
      "type": "string - Specific suggestion type targeting permit database fields",
      "fieldName": "string (required) - Exact database field name this suggestion targets",
      "originalValue": "string/array (optional) - Current value of the targeted field", 
      "suggestedValue": "string/array (required) - Improved value for the targeted field",
      "reasoning": "string (required) - TRBS/DGUV-based explanation for the improvement",
      "priority": "string (required) - Priority level: low, medium, high, critical"
    },
    "field_specific_guidelines": {
      "identifiedHazards": "Provide comprehensive, specific hazard identification text",
      "completedMeasures": "Return array of specific protective measure codes/names",
      "selectedHazards": "Return array of TRBS category IDs (e.g. ['2-1', '4-0', '7-1'])",
      "hazardNotes": "Return JSON string with hazard ID keys and safety note values",
      "additionalComments": "Provide detailed, actionable safety instructions text"
    },
    "important_notes": [
      "Each suggestion MUST target a specific permit database field via fieldName",
      "The permitId in the response MUST exactly match the permitId from the incoming request",
      "Use authentic TRBS categories and DGUV regulations in reasoning",
      "Suggestions are applied directly to database fields when accepted",
      "Focus on German industrial safety standards and requirements",
      "Always provide realistic, implementable safety improvements"
    ]
  }
}